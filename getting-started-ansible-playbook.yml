---

###############################################################################
# Set timezone and install docker
#
# author: Nick Yeoman
# website: https://www.NickYeoman.com/blog/getting-started-with-ansible/
###############################################################################

- hosts: all

  #Varibles, change to your requirements
  vars:
    v_username: nick
    v_hostname: nixbuntu
    
  tasks:
  - name: Set Timezone to Vancouver
    timezone: name=America/Vancouver

  - name: Add Docker GPG key
    apt_key: url=https://download.docker.com/linux/ubuntu/gpg

  - name: Add Docker APT repository
    apt_repository:
      repo: deb [arch=amd64] https://download.docker.com/linux/ubuntu {{ansible_distribution_release}} stable

  - name: retry if needed using command apt-get update
    command: apt-get update
    when: apt_result is failed

  - name: Install Docker and my docker dependancies
    apt:
      state: latest
      pkg:
      - apt-transport-https
      - ca-certificates
      - curl
      - software-properties-common
      - docker.io
      - docker-compose
      - python-apt
          
  - name: Allow defined user to use docker, usermod -aG docker $USER
    user:
      name: "{{ v_username}}"
      shell: /bin/bash
      group: "{{ v_username}}"
      groups: docker, sudo, adm, dip, plugdev, lxd
      state: present
      
  - hostname:
    name: "{{ v_hostname }}"
    
